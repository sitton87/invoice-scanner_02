<!DOCTYPE html>
<html lang="he" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>×ª×¨×©×™× ×–×¨×™××” - OCR Mode</title>
    <style>
      body {
        font-family: "Arial", sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        margin: 0;
        padding: 20px;
        direction: rtl;
      }
      .container {
        max-width: 1400px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        padding: 30px;
      }
      h1 {
        text-align: center;
        color: #4a148c;
        margin-bottom: 30px;
        font-size: 2.2em;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
      }
      .flowchart {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
        padding: 20px;
      }
      .box {
        background: #673ab7;
        color: white;
        padding: 15px 25px;
        border-radius: 12px;
        text-align: center;
        font-weight: bold;
        box-shadow: 0 4px 15px rgba(103, 58, 183, 0.3);
        min-width: 200px;
        transition: transform 0.3s ease;
      }
      .box:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(103, 58, 183, 0.4);
      }
      .diamond {
        background: #ff5722;
        color: white;
        padding: 20px;
        clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
        width: 180px;
        height: 180px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        font-weight: bold;
        box-shadow: 0 4px 15px rgba(255, 87, 34, 0.3);
      }
      .ocr-box {
        background: #00bcd4;
        box-shadow: 0 4px 15px rgba(0, 188, 212, 0.3);
        border: 2px solid #006064;
      }
      .intro-box {
        background: #9c27b0;
        box-shadow: 0 4px 15px rgba(156, 39, 176, 0.3);
      }
      .main-box {
        background: #4caf50;
        box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
      }
      .api-box {
        background: #f44336;
        color: white;
        border: 3px solid #d32f2f;
        animation: pulse 2s infinite;
      }
      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1);
        }
      }
      .text-flow-box {
        background: #ffc107;
        color: #000;
        border: 3px solid #ff8f00;
        font-weight: bold;
      }
      .arrow {
        font-size: 2em;
        color: #4a148c;
        margin: 5px 0;
      }
      .branch {
        display: flex;
        justify-content: space-around;
        width: 100%;
        max-width: 1200px;
        margin: 20px 0;
      }
      .branch-left,
      .branch-right {
        display: flex;
        flex-direction: column;
        align-items: center;
        flex: 1;
        margin: 0 20px;
      }
      .branch-title {
        background: #4a148c;
        color: white;
        padding: 10px 20px;
        border-radius: 25px;
        font-weight: bold;
        margin-bottom: 20px;
      }
      .merge-arrow {
        position: relative;
        width: 100%;
        height: 40px;
        margin: 20px 0;
      }
      .merge-arrow::before {
        content: "";
        position: absolute;
        left: 20%;
        top: 50%;
        width: 60%;
        height: 2px;
        background: #4a148c;
      }
      .merge-arrow::after {
        content: "â–¼";
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        font-size: 1.5em;
        color: #4a148c;
        background: white;
        padding: 0 10px;
      }
      .summary {
        background: #f3e5f5;
        border: 2px solid #9c27b0;
        border-radius: 10px;
        padding: 20px;
        margin-top: 30px;
        direction: rtl;
      }
      .summary h3 {
        color: #4a148c;
        margin-bottom: 15px;
        border-bottom: 2px solid #9c27b0;
        padding-bottom: 5px;
      }
      .file-box {
        background: #ff9800;
        box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);
      }
      .description {
        font-size: 0.9em;
        color: rgba(255, 255, 255, 0.9);
        margin-top: 5px;
        font-weight: normal;
      }
      .highlight-ocr {
        background: linear-gradient(45deg, #00bcd4, #0097a7);
        box-shadow: 0 0 20px rgba(0, 188, 212, 0.5);
      }
      .tesseract-box {
        background: #795548;
        box-shadow: 0 4px 15px rgba(121, 85, 72, 0.3);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ” ×ª×¨×©×™× ×–×¨×™××” - OCR Mode</h1>

      <div class="flowchart">
        <!-- ×”×ª×—×œ×” -->
        <div class="box">
          <div>OCR Mode ×”×ª×—×œ×”</div>
        </div>

        <div class="arrow">â†“</div>

        <div class="box">
          <div>ui.py: process_in_background()</div>
          <div class="description">×§×‘×™×¢×”: use_ocr = True</div>
        </div>

        <div class="arrow">â†“</div>

        <div class="box">
          <div>full_processor.py</div>
          <div>process_full_invoice()</div>
          <div class="description">×™×¦×™×¨×ª result structure</div>
        </div>

        <div class="arrow">â†“</div>

        <!-- ×©×œ×‘ OCR ×”×¨××©×•×Ÿ -->
        <div class="box highlight-ocr">
          <div>ğŸ” ×©×œ×‘ 1: OCR Processing</div>
          <div>ocr_processor.process_invoice_with_ocr()</div>
          <div class="description">×—×™×œ×•×¥ ×˜×§×¡×˜ ××”×ª××•× ×”/PDF</div>
        </div>

        <div class="arrow">â†“</div>

        <div class="diamond">
          <div>×¡×•×’ ×”×§×•×‘×¥?<br />PDF ××• ×ª××•× ×”</div>
        </div>

        <div class="arrow">â†“</div>

        <div class="box file-box">
          <div>×× PDF: _process_pdf_for_ocr()</div>
          <div>×× ×ª××•× ×”: _preprocess_image()</div>
          <div class="description">×¢×™×‘×•×“ ××§×“×™× + ×©×™×¤×•×¨ ××™×›×•×ª</div>
        </div>

        <div class="arrow">â†“</div>

        <div class="box highlight-ocr">
          <div>ğŸ”„ _auto_rotate_image()</div>
          <div class="description">×–×™×”×•×™ ×•×—×™×§×•×Ÿ ×¡×™×‘×•×‘ ××•×˜×•××˜×™</div>
        </div>

        <div class="arrow">â†“</div>

        <div class="box tesseract-box">
          <div>ğŸ”¤ _extract_text_tesseract()</div>
          <div class="description">
            Tesseract OCR: ×¢×‘×¨×™×ª + ×× ×’×œ×™×ª, PSM ××¨×•×‘×™×
          </div>
        </div>

        <div class="arrow">â†“</div>

        <div class="box api-box">
          <div>Claude API Call #1 (OCR Analysis)</div>
          <div class="description">
            _analyze_text_with_claude() - × ×™×ª×•×— ×˜×§×¡×˜ OCR
          </div>
        </div>

        <div class="arrow">â†“</div>

        <div class="box text-flow-box">
          <div>ğŸ“ extracted_text ××•×›×Ÿ</div>
          <div class="description">×˜×§×¡×˜ × ×§×™ ×–×•×¨× ×œ×©× ×™ ×”×¢× ×¤×™×</div>
        </div>

        <div class="arrow">â†“</div>

        <div class="diamond">
          <div>××™×–×” ×—×œ×§×™× ×œ×¢×‘×“?<br />INTRO + MAIN</div>
        </div>

        <!-- ×”×¡×ª×¢×¤×•×ª -->
        <div class="branch">
          <!-- INTRO Branch -->
          <div class="branch-left">
            <div class="branch-title">INTRO Branch</div>

            <div class="box intro-box">
              <div>intro_analyzer.py</div>
              <div>analyze_intro()</div>
              <div class="description">×§×‘×œ×ª extracted_text</div>
            </div>

            <div class="arrow">â†“</div>

            <div class="box intro-box">
              <div>_create_intro_prompt()</div>
              <div class="description">×™×¦×™×¨×ª ×¤×¨×•××¤×˜ ××¤×•×¨×˜</div>
            </div>

            <div class="arrow">â†“</div>

            <div class="box intro-box">
              <div>_analyze_intro_from_text()</div>
              <div class="description">×¢×™×‘×•×“ ×˜×§×¡×˜ OCR (×œ× ×ª××•× ×”)</div>
            </div>

            <div class="arrow">â†“</div>

            <div class="box api-box">
              <div>Claude API Call #2</div>
              <div class="description">×˜×§×¡×˜ + ×¤×¨×•××¤×˜ INTRO</div>
            </div>

            <div class="arrow">â†“</div>

            <div class="box intro-box">
              <div>_extract_json_from_response()</div>
              <div class="description">×—×™×œ×•×¥ JSON ××ª×©×•×‘×”</div>
            </div>

            <div class="arrow">â†“</div>

            <div class="box intro-box">
              <div>_clean_and_validate_intro()</div>
              <div class="description">× ×™×§×•×™ + metadata</div>
            </div>
          </div>

          <!-- MAIN Branch -->
          <div class="branch-right">
            <div class="branch-title">MAIN Branch</div>

            <div class="box main-box">
              <div>full_processor.py</div>
              <div>_process_main_from_text()</div>
              <div class="description">×¢×™×‘×•×“ MAIN ××˜×§×¡×˜ OCR</div>
            </div>

            <div class="arrow">â†“</div>

            <div class="box main-box">
              <div>×™×¦×™×¨×ª ×¤×¨×•××¤×˜ MAIN</div>
              <div class="description">×¤×¨×•××¤×˜ ×œ×—×™×œ×•×¥ ×¨×©×™××ª ×¤×¨×™×˜×™×</div>
            </div>

            <div class="arrow">â†“</div>

            <div class="box api-box">
              <div>Claude API Call #3</div>
              <div class="description">×˜×§×¡×˜ + ×¤×¨×•××¤×˜ ×¨×©×™××ª ×¤×¨×™×˜×™×</div>
            </div>

            <div class="arrow">â†“</div>

            <div class="box main-box">
              <div>×—×™×œ×•×¥ JSON</div>
              <div class="description">×¨×©×™××ª ×¤×¨×™×˜×™× ××ª×©×•×‘×ª ×§×œ×•×“</div>
            </div>

            <div class="arrow">â†“</div>

            <div class="box main-box">
              <div>json.loads()</div>
              <div class="description">×”××¨×” ×œ-Python dict</div>
            </div>
          </div>
        </div>

        <!-- ××™×—×•×“ -->
        <div class="merge-arrow"></div>

        <div class="box">
          <div>full_processor.py: _create_summary()</div>
          <div class="description">×—×™×©×•×‘ ×¡×˜×˜×™×¡×˜×™×§×•×ª</div>
        </div>

        <div class="arrow">â†“</div>

        <div class="box">
          <div>_save_full_result()</div>
          <div class="description">×©××™×¨×” ×¢× timestamp</div>
        </div>

        <div class="arrow">â†“</div>

        <div class="box">
          <div>ui.py: show_results()</div>
          <div class="description">×”×¦×’×ª ×ª×•×¦××•×ª + ×˜×§×¡×˜ OCR ×œ××©×ª××©</div>
        </div>
      </div>

      <!-- ×¡×™×›×•× -->
      <div class="summary">
        <h3>ğŸ” ×¡×™×›×•× ×ª×”×œ×™×š OCR Mode</h3>

        <h4>×©×œ×‘ OCR ×¨××©×•×Ÿ:</h4>
        <ul>
          <li><strong>ocr_processor.py</strong> - ××‘×¦×¢ OCR ××œ× ×¢×œ ×”×§×•×‘×¥</li>
          <li>
            <strong>×–×™×”×•×™ ×•×—×™×§×•×Ÿ ×¡×™×‘×•×‘ ××•×˜×•××˜×™</strong> - _auto_rotate_image()
          </li>
          <li><strong>Tesseract OCR</strong> - ×—×™×œ×•×¥ ×˜×§×¡×˜ ×‘×¢×‘×¨×™×ª ×•×× ×’×œ×™×ª</li>
          <li><strong>Claude API #1</strong> - × ×™×ª×•×— ×•×¢×™×‘×•×“ ×”×˜×§×¡×˜ ×”××—×•×œ×¥</li>
        </ul>

        <h4>×§×¨×™××•×ª API ×œ×§×œ×•×“ (×¡×”"×› 3):</h4>
        <ul>
          <li>
            <strong>API #1 (OCR Analysis):</strong> ×˜×§×¡×˜ OCR â†’ JSON ××¢×•×‘×“ ×©×œ
            ×¨×©×™××ª ×¤×¨×™×˜×™×
          </li>
          <li>
            <strong>API #2 (INTRO):</strong> ×˜×§×¡×˜ OCR + ×¤×¨×•××¤×˜ INTRO â†’ ×¤×¨×˜×™
            ×—×©×‘×•× ×™×ª
          </li>
          <li>
            <strong>API #3 (MAIN):</strong> ×˜×§×¡×˜ OCR + ×¤×¨×•××¤×˜ MAIN â†’ ×¨×©×™××ª
            ×¤×¨×™×˜×™× (× ×•×¡×£)
          </li>
        </ul>

        <h4>×”×‘×“×œ×™× ×-Image Mode:</h4>
        <ul>
          <li><strong>×©×œ×‘ OCR ×¨××©×•×Ÿ</strong> - ×—×™×œ×•×¥ ×˜×§×¡×˜ ×œ×¤× ×™ ×¢×™×‘×•×“ ×§×œ×•×“</li>
          <li><strong>INTRO ××§×‘×œ ×˜×§×¡×˜</strong> ×‘××§×•× ×ª××•× ×”</li>
          <li>
            <strong>MAIN ××¢×•×‘×“ ×‘×¤×•× ×§×¦×™×” ×¤× ×™××™×ª</strong> ×‘××§×•× processor.py
          </li>
          <li><strong>3 ×§×¨×™××•×ª API</strong> ×‘××§×•× 2</li>
          <li><strong>×”×¦×’×ª ×˜×§×¡×˜ OCR</strong> ×‘×ª×•×¦××•×ª ×”×¡×•×¤×™×•×ª</li>
        </ul>

        <h4>×¡×§×¨×™×¤×˜×™× ××¢×•×¨×‘×™×:</h4>
        <ul>
          <li><strong>ui.py</strong> - ×××©×§ ××©×ª××© ×•×ª×™××•×</li>
          <li>
            <strong>full_processor.py</strong> - ×× ×”×œ ××¨×›×–×™
            ×•-_process_main_from_text()
          </li>
          <li><strong>ocr_processor.py</strong> - OCR ××ª×§×“× ×¢× ×ª×™×§×•×Ÿ ×¡×™×‘×•×‘</li>
          <li><strong>intro_analyzer.py</strong> - ×¢×™×‘×•×“ ×¤×¨×˜×™ ×—×©×‘×•× ×™×ª ××˜×§×¡×˜</li>
        </ul>

        <h4>×˜×›× ×•×œ×•×’×™×•×ª OCR:</h4>
        <ul>
          <li><strong>Tesseract</strong> - ×—×™×œ×•×¥ ×˜×§×¡×˜ ×¢× PSM ××¨×•×‘×™×</li>
          <li><strong>OpenCV</strong> - ×¢×™×‘×•×“ ×ª××•× ×” ×•×ª×™×§×•×Ÿ ×¡×™×‘×•×‘</li>
          <li><strong>PyMuPDF</strong> - ×¢×™×‘×•×“ PDF ×‘×¨×–×•×œ×•×¦×™×” ×’×‘×•×”×”</li>
          <li><strong>PIL/Pillow</strong> - ×¢×™×‘×•×“ ×ª××•× ×” ×‘×¡×™×¡×™</li>
        </ul>
      </div>
    </div>
  </body>
</html>
